# Traceability Matrix (v1.4) — Purpose → Function → Data → Screen

Version: v1.4 (Design Freeze)  
Use: implementation drift checks (especially PR0–PR2), and scope control for future PRs.

---

## Global constraints (always enforce)
- UI displays **Title + Summary + Link only** (no article body).
- Do not collect from login/membership-required sources; respect terms.
- All variability is config-driven via `config/*.yml`.
- Default schedule is **07:00 JST** (configurable).
- Local-first persistence with auditability is mandatory.
- Default geo is `tokyo_metro` (Tokyo/Kanagawa/Chiba/Saitama), expandable.
- Watchlist categories: competitor / hr_major / platform / government.

---

## 1) Purpose → Decision → Function → Data → Screen

| Purpose (Business Outcome) | Primary Decision Supported | Function (Capability) | Config Inputs | Persisted Outputs (Concepts) | Screen(s) | Drift / Acceptance Checks |
|---|---|---|---|---|---|---|
| Daily actionable brief (recruiting & recruiting web marketing) | “What matters today?” “What changed?” | Daily Brief aggregation from latest successful run | sources.yml, schedule.yml, geo.yml | run, news_items, daily_digest, explain_json | `/daily` | Must show run context; must not show article body; evidence links required. |
| Detect assumption-breaking events | “Do we need to change strategy?” | Alert rules and severity (P1/P2) | alerts.yml, scoring.yml | alerts, explain_json, evidence_links | `/daily`, `/exports/*` | Alerts are reproducible from stored data; each alert has reason + evidence. |
| Watch competitor/platform movements | “Is an entity spiking unusually?” | Watchlist matching + spike detection | watchlist.yml, alerts.yml | watch_mentions, alerts(type=watch_spike) | `/daily` | Mention provenance stored; thresholds configurable. |
| Monitor KPI shifts via indicators | “Are market conditions tightening/loosening?” | Series resolver + indicator ingestion + index computation | series.yml, geo.yml, scoring.yml | series_points, daily_index, explain_json | `/daily` | Missing series handled gracefully; explain_json includes missing flags. |
| Operational reliability (non-brittle) | “Can we trust today’s run?” “What failed?” | Run manager, locking, per-source status | schedule.yml, sources.yml | run, source_run, ops summaries | `/daily`, `/run/manual` | One source failing does not crash entire run; lock prevents double run. |
| Future BI interoperability | “Can we connect BI tools later?” | Stable views/exports from DuckDB | (none required initially) | SQL views / exports | `/exports/*` | Exports derived from stored data; schema versioned; no secrets. |

---

## 2) Screen → Data contract (minimum)

| Screen | Must show | Backing data (concepts) | Notes |
|---|---|---|---|
| `/daily` | run_id + run time, top alerts, index matrix, top changes, evidence links | run, alerts, daily_index, news_items, watch_mentions | Title+Summary+Link only. |
| `/run/manual` | run trigger + status + history (later) | run, source_run | operator-only. |
| `/exports/*` | export endpoints for alerts/digests (later) | derived from stored tables/views | operator-only. |
| `/login` | login form | session auth | viewer/operator roles. |

---

## 3) Config → Behavior mapping (quick reference)

| Config file | Controls | Must remain configurable |
|---|---|---|
| `config/sources.yml` | which sources, rate limits, kind, enabled | add/remove sources without code change (within supported kinds) |
| `config/watchlist.yml` | entities + categories + matching policy | add/modify watch entities without code change |
| `config/geo.yml` | geo rollups | tokyo_metro default; future geo additions |
| `config/schedule.yml` | daily schedule & manual enablement | default 07:00 JST; allow change |
| `config/series.yml` | semantic series keys & resolver mapping | allow adding series keys and resolvers |
| `config/scoring.yml` | weights/normalization for indices | adjustable without code change |
| `config/alerts.yml` | thresholds/windows/severity rules | adjustable without code change |

---

## 4) Drift checklist (use in PR review)
A PR must update this matrix if it changes:
- a decision supported,
- a function capability,
- a stored field/schema contract,
- a screen’s data or behavior,
- a config-driven behavior surface.
